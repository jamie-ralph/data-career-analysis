---
title: "Stack Overflow Developer Survey 2019: Exploring the characteristics of data scientists and data analysts"
output:
    github_document:
        html_preview: true
---
<br>

```{r prep, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

source("prepare_data.r")

devtype_scale_colour <- function() {
    scale_colour_manual(breaks = c("Data analyst", "Data scientist"),
                        values = c("#94D0FF", "#AD8CFF"))
}

devtype_scale_fill <- function() {
    scale_fill_manual(breaks = c("Data analyst", "Data scientist"),
                        values = c("#94D0FF", "#AD8CFF"))
}

med_ds <- scales::dollar(
  median(df[df$DevType == "Data scientist",]$ConvertedComp)
)

med_da <- scales::dollar(
  median(df[df$DevType == "Data analyst",]$ConvertedComp)
)

Mode <- function(x) {
  ux <- unique(x)
  ux[which.max(tabulate(match(x, ux)))]
}
```

In this project I'll be exploring survey responses from data scientists and data analysts in [Stack Overflow's 2019 Developer Survey](https://insights.stackoverflow.com/survey/2019#overview). I'll be using the survey responses to build statistical models of industry salaries. This project reuses code from Julia Silge's brilliant analysis of [gender and salary in the tech industry](https://juliasilge.com/blog/salary-gender/). 



#### Preparing the data

To fit a more accurate model of salary the data were filtered to:

* full-time workers 

* residing in the United States

* salaries between between \$30,000 and \$300,000

* individual contributors working in industry only (i.e. removing upper management and academics)

This made the data more consistent for visualising and modelling. [This analysis by Charles Modingwa](https://medium.com/@charlesmodingwa/2019-stack-overflow-survey-analysis-c8dac1617d40) showed that data scientist salaries differed across countries. Filtering only to the United States removes any unwanted effects of country and still leaves a good sample size. 

Respondents were labelled as data analysts if they identified as a "Data or business analyst" or a data scientist if identifying as "Data scientist or machine learning specialist". `r nrow(both_jobs)` respondents identified with both labels. These responses were removed to focus the analysis on the differences between the two groups. This left `r nrow(df)` responses, consisting of `r nrow(filter(df, DevType == "Data scientist"))` data scientists and `r nrow(filter(df, DevType == "Data analyst"))` data analysts. 


### Part 1 - Exploring the data

Before building a model, I'll build some exploratory plots of salary and other
variables in the survey. I chose variables based on analyses that have already looked at modelling salaries in this dataset, combined with some additional variables I was interested in. 

#### What do data scientists and data analysts earn? 

If we take a look at salaries overall, the median salary is higher for data scientists (`r med_ds`) than for data analysts (`r med_da`). Salaries for both groups are positively skewed due to small number of respondents earning about $150,000 or more. For modelling purposes the salaries will be log10 transformed to make them more normally distributed. 
```{r fig.width=12}
salary_boxplot <- df %>%
    ggplot(aes(DevType, ConvertedComp,  colour = DevType)) +
    geom_boxplot(outlier.colour = NA, width = 0.5) +
    theme_minimal(base_size = 12) +
    geom_jitter(alpha = 0.3, width = 0.1) +
    scale_y_continuous(labels = scales::dollar_format()) +
    labs(
        x = "",
        y = "Salary (USD)"
    ) +
    theme(
        legend.position = "none"
    ) +
    devtype_scale_colour()

salary_hist <- df %>%
  ggplot(aes(x = ConvertedComp, y = DevType))  +
  ggridges::geom_density_ridges(aes(fill = DevType)) +
  theme_minimal() +
  scale_x_continuous(
    labels = scales::dollar_format()
  ) +
  labs(
    x = "Salary (USD)",
    y = ""
  ) +
  devtype_scale_fill() +
  theme(
    legend.position = "none"
  ) +
  ggtitle("Original salary")

salary_hist_log <- df %>%
  ggplot(aes(x = log10(ConvertedComp), y = DevType))  +
  ggridges::geom_density_ridges(aes(fill = DevType)) +
  theme_minimal() +
  scale_x_continuous(
    labels = scales::dollar_format()
  ) +
  labs(
    x = "Log10 salary (USD)",
    y = ""
  ) +
  devtype_scale_fill() +
  theme(
    legend.position = "none"
  ) +
  ggtitle("Salary with log10 transform")



salary_boxplot / (salary_hist + salary_hist_log)
```

<br>

#### Does salary differ by gender identity?

The data shows that the majority of respondents indentified as men. Data scientists had higher median salaries than data analysts across the gender groups. It's possible that women are under-represented in this sample, an issue that has been identified for the survey across all developer roles. This means that, despite the boxplot indicating only a small gender difference between men and women, this result may not reflect the real world. `r nrow(filter(df, Trans == "Yes"))` respondents in this sample identified as trans. 
 

```{r fig.width=12}
df %>%
    filter(!is.na(Gender), Gender != "Not available") %>%
    ggplot(aes(x = DevType, y = ConvertedComp, colour = DevType)) + 
    geom_boxplot(outlier.colour = NA) + 
    facet_wrap(~factor(Gender, levels = c("Man", 
                                          "Woman", 
                                          "Non-binary, genderqueer, or gender non-conforming"))) +
    theme_minimal(base_size = 12) +
    geom_jitter(alpha = 0.3, width = 0.2) +
    scale_y_continuous(labels = scales::dollar_format()) +
    labs(
        x = "",
        y = "Salary (USD)"
    ) +
    theme(
        legend.position = "none"
    ) +
    devtype_scale_colour()

df %>%
    tabyl(DevType, Gender) %>%
    adorn_percentages("row") %>%
    adorn_pct_formatting() %>%
    adorn_ns() %>%
    select(DevType, Man, Woman, `Non-binary, genderqueer, or gender non-conforming`, `Not available`) %>%
    kableExtra::kable()

```

#### Do salaries increase with age?

The median age of the sample was `r median(df$Age, na.rm = T)`. The distributions of ages were positively skewed. If we plot a basic linear regression line we can see that salary increases with age. This can be expected if people who are older have more experience, something I'll look at shortly. 

```{r, fig.width=12}
hist_age <- df %>%
    ggplot(aes(x = Age, fill = DevType, colour = DevType)) +
    geom_histogram(bins = 100) +
    
    theme_minimal(base_size = 12) +
    devtype_scale_fill() +
    devtype_scale_colour() +
    labs(
        y = "Number of respondents"
    ) +
    theme(
        legend.position = "none"
    )
    

scatter_age <- df %>%
    filter(Age >= 18) %>%
    ggplot(aes(x = Age, y = log10(ConvertedComp), colour = DevType)) +
    theme_minimal(base_size = 12) +
    guides(colour = guide_legend(override.aes = list(size = 5))) +
    geom_point() +
    geom_smooth(method = "lm", se = FALSE, size = 1.5) +
    labs(
        y = "Log10 Salary (USD)"
    ) +
    scale_y_continuous(labels = scales::dollar_format()) +
    devtype_scale_colour() 
   # facet_wrap(~DevType)

hist_age + scatter_age
```

#### Does education affect future salaries?

Median salary was higher for data scientists at each aggregated qualification level. Overall there was a stronger positive effect of education on median earnings in the data scientist group compared to the data analyst group. Breaking down salaries by undergrad major and developer type shows that data scientists who studied maths or statistics had the highest median salary while data analysts with a social sciences background had the lowest median salary. 


```{r}
ed_boxplot <- df %>%
    filter(!is.na(EdLevel)) %>%
    ggplot(aes(x = EdLevel, y = ConvertedComp, colour = DevType)) +
    geom_boxplot() +
    scale_y_continuous(labels = scales::dollar_format()) +
    theme_minimal(base_size = 12) +
    scale_colour_manual(breaks = c("Data analyst", "Data scientist"),
                        values = c("#94D0FF", "#AD8CFF")) +
    labs(
        x = "Highest qualification",
        y = "Salary (USD)"
    )

ed_table <- df %>%
    filter(!is.na(UndergradMajor)) %>%
    group_by(UndergradMajor, DevType) %>%
    summarise(`Sample size` = n(), 
              `Median salary` = median(ConvertedComp)) %>%
    filter(`Sample size` >= 30) %>%
    arrange(-`Median salary`) %>%
    mutate(
        `Median salary` = scales::dollar(`Median salary`)
    ) %>%
    kableExtra::kable()

ed_boxplot 

ed_table



```

#### Do employment variables affect salary?

Median salaries were similar between respondents who develope professionally and those who don't develop professionally. There was an upward trend of salary ranges as organisation size increased. 
<br>

```{r}
prof_boxplot <- df %>%
    ggplot(aes(x = MainBranch, y = ConvertedComp, colour = DevType)) +
    geom_boxplot() +
    scale_y_continuous(
        labels = scales::dollar_format()
    ) +
    theme_minimal() +
  labs(
    x = "",
    y = "Salary (USD)"
  ) +
  theme(
    legend.position = "none"
  ) +
    devtype_scale_colour() 

org_boxplot <- df %>%
    filter(!is.na(OrgSize)) %>%
    mutate(
        OrgSize = factor(OrgSize,
                         levels = c(
        "Between 2 and 99",
        "Between 100 and 999",
        "Between 1,000 and 4,999",
        "5,000 or more")
        )
    ) %>%
    ggplot(aes(x = OrgSize, y = ConvertedComp, colour = DevType)) +
    geom_boxplot() +
    scale_y_continuous(
        labels = scales::dollar_format()
    ) +
    labs(
      x = "Organisation size (employees)",
      y = "Salary (USD)"
    ) +
    theme_minimal() +
    devtype_scale_colour() +
    coord_flip()

prof_boxplot / org_boxplot
    
```

Most respondents in the sample worked `r Mode(df$WorkWeekHrs)` hours a week. The scatterplots here suggest that higher working hours per week may result in higher log10 salary, but fitting a linear relationship would be confounded by the large number of respondents on the 40 hours line. 

``` {r fig.width = 12}
df %>%
  filter(!is.na(WorkWeekHrs),
         WorkWeekHrs < 100) %>%
  ggplot(aes(x = WorkWeekHrs, y = log10(ConvertedComp), colour = DevType)) +
  geom_point() +
  scale_y_continuous(
    labels = scales::dollar_format()
  ) +
  theme_minimal() +
  theme(
    legend.position = "none"
  ) +
  labs(
    x = "Hours worked per week",
    y = "Log10 Salary (USD)"
  ) +
  devtype_scale_colour() +
  facet_wrap(~DevType) 
  
```

#### Does coding experience affect salary?

If we take the median salary for each year of professional coding experience, we see a positive relationship in the data analyst group. The data scientist group is more scattered as years of professional coding experience goes above 25. 


```{r fig.width=12}
df %>%
  filter(YearsCodePro != "Less than 1 year") %>%
  mutate(
    YearsCodePro = as.numeric(YearsCodePro)
  ) %>%
  group_by(DevType, YearsCodePro) %>%
  summarise(med_salary = median(ConvertedComp)) %>%
  ggplot(aes(x = YearsCodePro, y = med_salary)) +
  geom_point(size = 2.5, aes(colour = DevType)) +
  scale_y_continuous(
    labels = scales::dollar_format()
  ) +
  labs(
    x = "Years coding professionally",
    y = "Median salary (USD)"
  ) +
  theme_minimal(base_size = 12) +
  devtype_scale_colour() +
  facet_wrap(~DevType) 





```

The number of programming languages used had a small positive effect on median earnings in the data analyst group, however the effect was somewhat negative in the data scientist group.

```{r fig.width=12}
langs_used <- df %>%
    mutate(
        LanguageWorkedWith = str_split(LanguageWorkedWith, pattern = ";")
    ) %>%
    unnest(LanguageWorkedWith) %>%
    group_by(Respondent) %>%
    summarise(languages_used = n()) %>%
    mutate(
        languages_used = case_when(
            languages_used > 10 ~ 10,
            TRUE ~ as.numeric(languages_used)
        )
    )

df %>%
    inner_join(langs_used, by = "Respondent") %>%
    group_by(DevType, languages_used) %>%
    summarise(med_salary = median(ConvertedComp)) %>%
    ggplot(aes(x = languages_used, y = med_salary)) +
    geom_line(alpha = 0.5, size = 2, aes(colour = DevType)) +
    theme_minimal(base_size = 12) +
    labs(
        x = "Number of programming languages used \n (capped at 10)",
        y = "Median salary (USD)"
    ) +
    scale_y_continuous(
        labels = scales::dollar_format(),
        limits = c(0, 150000)
    ) +
    scale_x_continuous(
        breaks = 1:10,
        minor_breaks = NULL
    ) +
    devtype_scale_colour() 
```



#### Do open source contributors earn more?

Finally, the plot below shows that open source contributions have a small positive effect on median salaries in the data scientist group but less of an effect in the data analyst group. 

```{r}
df %>%
      ggplot(aes(x = OpenSourcer, y = log10(ConvertedComp), colour = DevType)) + 
      geom_boxplot() +
      labs(
            y = "Log10 Salary (USD)",
            x = ""
        ) +
    theme_minimal() +
    facet_wrap(~DevType) +
    devtype_scale_colour()
```

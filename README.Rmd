---
title: "Stack Overflow Developer Survey 2019: Exploring the characteristics of data scientists and data analysts"
output:
    github_document:
        html_preview: true
---
<br>

```{r prep, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

source("prepare_data.r")

devtype_scale_colour <- function() {
    scale_colour_manual(breaks = c("Data analyst", "Data scientist"),
                        values = c("#94D0FF", "#AD8CFF"))
}

devtype_scale_fill <- function() {
    scale_fill_manual(breaks = c("Data analyst", "Data scientist"),
                        values = c("#94D0FF", "#AD8CFF"))
}

med_ds <- scales::dollar(
  median(df[df$DevType == "Data scientist",]$ConvertedComp)
)

med_da <- scales::dollar(
  median(df[df$DevType == "Data analyst",]$ConvertedComp)
)

Mode <- function(x) {
  ux <- unique(x)
  ux[which.max(tabulate(match(x, ux)))]
}
```

In this project I'll be exploring survey responses from data scientists and data analysts in [Stack Overflow's 2019 Developer Survey](https://insights.stackoverflow.com/survey/2019#overview). I'll be using the survey responses to model industry salaries (converted to US Dollars or USD). Huge credit goes Julia Silge's brilliant analysis of [gender and salary in the tech industry](https://juliasilge.com/blog/salary-gender/) for both inspiring the project and for providing useful code for wrangling the survey data. 



#### Notes on data prep

To fit a more accurate model of salary the data were filtered to:

* full-time workers 

* salaries between between \$30,000 and \$300,000

* individual contributors working in industry only (i.e. removing upper management and academics)

Respondents were labelled as data analysts if they identified as a "Data or business analyst" or a data scientist if identifying as "Data scientist or machine learning specialist". `r nrow(both_jobs)` respondents identified with both labels. These responses were removed to focus the analysis on the differences between the two groups. This left `r nrow(df)` responses, consisting of `r nrow(filter(df, DevType == "Data scientist"))` data scientists and `r nrow(filter(df, DevType == "Data analyst"))` data analysts. 


### Exploring the data

Before building a model, I'll build some exploratory plots of salary and other
variables in the survey. This will help to select relevant variables for the model. 

#### What do data scientists and data analysts earn? 

If we take a look at salaries overall, the median salary for data scientists is slightly higher (`r med_ds`) than for data analysts (`r med_da`). Salaries for both groups are positively skewed, so fitting a linear model to the data will require a log10 transform. 
```{r fig.width=12}
salary_boxplot <- df %>%
    ggplot(aes(DevType, ConvertedComp,  colour = DevType)) +
    geom_boxplot(outlier.colour = NA, width = 0.5) +
    theme_minimal(base_size = 12) +
    geom_jitter(alpha = 0.3, width = 0.1) +
    scale_y_continuous(labels = scales::dollar_format()) +
    labs(
        x = "",
        y = "Salary (USD)"
    ) +
    theme(
        legend.position = "none"
    ) +
    devtype_scale_colour()

salary_hist <- df %>%
  ggplot(aes(x = ConvertedComp, y = DevType))  +
  ggridges::geom_density_ridges(aes(fill = DevType)) +
  theme_minimal() +
  scale_x_continuous(
    labels = scales::dollar_format()
  ) +
  labs(
    x = "Salary (USD)",
    y = ""
  ) +
  devtype_scale_fill() +
  theme(
    legend.position = "none"
  ) +
  ggtitle("Original salary")

salary_hist_log <- df %>%
  ggplot(aes(x = log10(ConvertedComp), y = DevType))  +
  ggridges::geom_density_ridges(aes(fill = DevType)) +
  theme_minimal() +
  scale_x_continuous(
    labels = scales::dollar_format()
  ) +
  labs(
    x = "Log10 salary (USD)",
    y = ""
  ) +
  devtype_scale_fill() +
  theme(
    legend.position = "none"
  ) +
  ggtitle("Salary with log10 transform")



salary_boxplot / (salary_hist + salary_hist_log)
```

<br>

#### Demographics 

##### Gender identity

The data shows that the majority of respondents indentified as men. Data scientists had higher median salaries than data analysts across the gender groups. It's possible that women are under-represented in this sample, an issue that has been identified for the survey overall. This means between-gender differences may not generalise beyond the sample. `r nrow(filter(df, Trans == "Yes"))` respondents in this sample identified as trans. 
 

```{r fig.width=12}
df %>%
    filter(!is.na(Gender)) %>%
    mutate(Gender = case_when(
        str_detect(Gender, "Non-binary") ~ 
            "Non-binary, genderqueer, \n or gender non-conforming",
        TRUE ~ Gender
    )) %>%
    ggplot(aes(x = DevType, y = ConvertedComp, colour = DevType)) + 
    geom_boxplot(outlier.colour = NA) + 
    facet_wrap(~factor(Gender, levels = c("Man", 
                                          "Woman", 
                                          "Non-binary, genderqueer, \n or gender non-conforming"))) +
    theme_minimal(base_size = 12) +
    geom_jitter(alpha = 0.3, width = 0.2) +
    scale_y_continuous(labels = scales::dollar_format()) +
    labs(
        x = "",
        y = "Salary (USD)"
    ) +
    theme(
        legend.position = "none"
    ) +
    devtype_scale_colour()

df %>%
    mutate(Gender = case_when(
        str_detect(Gender, "Non-binary") ~ 
            "Non-binary/genderqueer/gender non-conforming",
        is.na(Gender) ~ "Not available",
        TRUE ~ Gender
    )) %>%
    tabyl(DevType, Gender) %>%
    adorn_percentages("row") %>%
    adorn_pct_formatting() %>%
    adorn_ns() %>%
    select(DevType, Man, Woman, `Non-binary/genderqueer/gender non-conforming`, `Not available`) %>%
    kableExtra::kable()

```

##### Age

The median age of the sample was `r median(df$Age, na.rm = T)`. The distributions of ages were positively skewed. There was no clear relationship between age and salary for either group. 

```{r, fig.width=12}
hist_age <- df %>%
    ggplot(aes(x = Age, fill = DevType, colour = DevType)) +
    geom_histogram(bins = 100) +
    theme_minimal(base_size = 12) +
    devtype_scale_fill() +
    devtype_scale_colour() +
    labs(
        y = "Number of respondents"
    ) +
    theme(
        legend.position = "none"
    )
    

scatter_age <- df %>%
    ggplot(aes(x = Age, y = log10(ConvertedComp), colour = DevType)) +
    theme_minimal(base_size = 12) +
    guides(colour = guide_legend(override.aes = list(size = 5))) +
    geom_point() +
    labs(
        y = "Log10 Salary (USD)"
    ) +
    scale_y_continuous(labels = scales::dollar_format()) +
    devtype_scale_colour() +
    facet_wrap(~DevType)

hist_age + scatter_age
```

#### Education

Median salary was higher for data scientists at each aggregated qualification level. Overall there was little effect of education on data scientist earnings, whereas earnings were slightly higher for data analysts with at least a bachelor's degree. Breaking down salaries by undergrad major and developer type shows that data scientists who studied maths or statistics had the highest median earnings whereas data analysts who'd studied maths or statistics had the lowest. 


```{r}
ed_boxplot <- df %>%
    filter(!is.na(EdLevel)) %>%
    mutate(
    EdLevel = fct_collapse(EdLevel,
      `Less than bachelor's` = c(
        "I never completed any formal education",
        "Primary/elementary school",
        "Secondary school (e.g. American high school, German Realschule or Gymnasium, etc.)",
        "Some college/university study without earning a degree",
        "Associate degree"
      ),
      `Bachelor's degree` = "Bachelor’s degree (BA, BS, B.Eng., etc.)",
      `Graduate degree` = c(
        "Other doctoral degree (Ph.D, Ed.D., etc.)",
        "Master’s degree (MA, MS, M.Eng., MBA, etc.)",
        "Professional degree (JD, MD, etc.)"
      )
    )
    ) %>%
    ggplot(aes(x = EdLevel, y = log10(ConvertedComp), colour = DevType)) +
    geom_boxplot() +
    scale_y_continuous(labels = scales::dollar_format()) +
    theme_minimal(base_size = 12) +
    scale_colour_manual(breaks = c("Data analyst", "Data scientist"),
                        values = c("#94D0FF", "#AD8CFF")) +
    labs(
        x = "Highest qualification",
        y = "Log 10 Salary (USD)"
    )

ed_table <- df %>%
    filter(!is.na(UndergradMajor)) %>%
    group_by(UndergradMajor, DevType) %>%
    summarise(`Sample size` = n(), 
              `Median salary` = median(ConvertedComp)) %>%
    filter(`Sample size` >= 30) %>%
    arrange(-`Median salary`) %>%
    mutate(
        `Median salary` = scales::dollar(`Median salary`)
    ) %>%
    kableExtra::kable()

ed_boxplot 

ed_table



```

#### Employment

Median salaries were highest for data scientists who weren't professional developers. Smaller organisation sizes were combined to reduce the number of size bands. There was an upward trend of salary ranges as organisation size increased. 
<br>

```{r}
prof_boxplot <- df %>%
    mutate(
        MainBranch = case_when(
            str_detect("I am a developer by profession", 
                       MainBranch) ~ "Professional developer",
            TRUE ~ "Not professional developer"
        )
    ) %>%
    ggplot(aes(x = MainBranch, y = log10(ConvertedComp), colour = DevType)) +
    geom_boxplot() +
    scale_y_continuous(
        labels = scales::dollar_format()
    ) +
    theme_minimal() +
  labs(
    x = "",
    y = "Log 10 Salary (USD)"
  ) +
  theme(
    legend.position = "none"
  ) +
    devtype_scale_colour() 

org_boxplot <- df %>%
    filter(!is.na(OrgSize)) %>%
    mutate(
     OrgSize = fct_collapse(OrgSize,
        `Freelancer/sole proprietor etc.` = "Just me - I am a freelancer, sole proprietor, etc.",
        `Between 2 and 99` = c("2-9 employees", "10 to 19 employees", "20 to 99 employees"),
        `Between 100 and 999` = c("100 to 499 employees", "500 to 999 employees"),
        `Between 1,000 and 4,999` = "1,000 to 4,999 employees",
        `Between 5,000 and 9,999` = "5,000 to 9,999 employees",
        `10,000 or more` = "10,000 or more employees"
        )
    ) %>%
    mutate(
        OrgSize = factor(OrgSize,
                         levels = c("Freelancer/sole proprietor etc.",
        "Between 2 and 99",
        "Between 100 and 999",
        "Between 1,000 and 4,999",
        "Between 5,000 and 9,999",
        "10,000 or more")
        )
    ) %>%
    ggplot(aes(x = OrgSize, y = log10(ConvertedComp), colour = DevType)) +
    geom_boxplot() +
    scale_y_continuous(
        name = "Log10 Salary (USD)",
        labels = scales::dollar_format()
    ) +
    theme_minimal() +
    devtype_scale_colour() +
    coord_flip()

prof_boxplot / org_boxplot
    
```

Most respondents in the sample worked `r Mode(df$WorkWeekHrs)` hours a week. The scatterplots below suggest that higher working hours per week don't result in higher salaries!

``` {r fig.width = 12}
df %>%
  filter(!is.na(WorkWeekHrs),
         WorkWeekHrs < 100) %>%
  ggplot(aes(x = WorkWeekHrs, y = log10(ConvertedComp), colour = DevType)) +
  geom_point() +
  scale_y_continuous(
    labels = scales::dollar_format()
  ) +
  theme_minimal() +
  theme(
    legend.position = "none"
  ) +
  labs(
    x = "Hours worked per week",
    y = "Log10 median salary"
  ) +
  devtype_scale_colour() +
  facet_wrap(~DevType) 
  
```

#### Coding & technical skills

##### Years coding

If we take the median salary for each year of professional coding experience, we see a positive relationship for data scientists and data analysts regardless of whether they code professionally. 


```{r fig.width=12}
years_code_prof_dev <- df %>%
  filter(YearsCodePro != "Less than 1 year",
         grepl("by profession", MainBranch)) %>%
  mutate(
    YearsCodePro = as.numeric(YearsCodePro)
  ) %>%
  group_by(DevType, YearsCodePro) %>%
  summarise(med_salary = median(ConvertedComp)) %>%
  ggplot(aes(x = YearsCodePro, y = med_salary)) +
  geom_point(size = 2.5, aes(colour = DevType)) +
  scale_y_continuous(
    labels = scales::dollar_format()
  ) +
  labs(
    x = "Years coding professionally",
    y = "Median salary (USD)"
  ) +
  theme_minimal(base_size = 12) +
  devtype_scale_colour() +
  facet_wrap(~DevType) +
  ggtitle("Professional developer")



years_code_not_prof_dev <- df %>%
  filter(YearsCodePro != "Less than 1 year",
         !grepl("by profession", MainBranch)) %>%
  mutate(
    YearsCodePro = as.numeric(YearsCodePro)
  ) %>%
  group_by(DevType, YearsCodePro) %>%
  summarise(med_salary = median(ConvertedComp)) %>%
  ggplot(aes(x = YearsCodePro, y = med_salary)) +
  geom_point(size = 2.5, aes(colour = DevType)) +
  scale_y_continuous(
    labels = scales::dollar_format()
  ) +
  labs(
    x = "Years coding professionally",
    y = "Median salary (USD)"
  ) +
  theme_minimal(base_size = 12) + 
  devtype_scale_colour() +
  facet_wrap(~DevType) +
  ggtitle("Not professional developer") 

years_code_prof_dev 

years_code_not_prof_dev

```

##### Open source 

Finally, the plot below shows that open source contributions don't seem to affect salary!

```{r}
df %>%
    mutate(OpenSourcer = fct_collapse(OpenSourcer,
      Never = "Never",
      Sometimes = "Less than once per year",
      Often = c(
        "Less than once a month but more than once per year",
        "Once a month or more often"
      )
    )
    ) %>%
        ggplot(aes(x = OpenSourcer, y = log10(ConvertedComp), colour = DevType)) + 
        geom_boxplot() +
        labs(
            y = "Log10 Salary (USD)",
            x = ""
        ) +
    theme_minimal() +
    facet_wrap(~DevType) +
    devtype_scale_colour()
```
